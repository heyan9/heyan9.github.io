<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <base target="_blank">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä½•å²©æœç´¢ç«™ - å®Œç¾ä¿®å¤ç‰ˆ</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
  
  <style>
    :root {
      --primary-blue: #0084ff;
      --bg-color: #ffffff;
      --glass-bg: rgba(255, 255, 255, 0.9);
      --border-color: #ebebeb;
      --text-main: #444;
      --text-sub: #8590a6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background-color: var(--bg-color);
      background-image: radial-gradient(circle at 10% 20%, rgba(0, 132, 255, 0.05) 0%, transparent 20%), 
                        radial-gradient(circle at 90% 80%, rgba(0, 132, 255, 0.05) 0%, transparent 20%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      font-weight: 400;
    }

    /* --- ç”¨æˆ·æ  (çŸ¥ä¹æç®€é£) --- */
    .user-bar {
      position: absolute; top: 20px; right: 20px;
      display: flex; align-items: center; 
      height: 40px; 
      padding: 0 4px 0 16px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
      z-index: 100;
      gap: 12px;
      font-size: 13px;
    }

    .fish-stats {
      display: flex; align-items: center; gap: 6px;
      color: var(--text-main); cursor: default; height: 100%;
    }
    .level-badge {
      background: rgba(0, 132, 255, 0.1); color: var(--primary-blue);
      padding: 1px 6px; border-radius: 4px; font-size: 12px; font-weight: 500;
    }
    #levelTitle { color: var(--text-sub); }
    .divider { width: 1px; height: 14px; background: #e0e0e0; }
    
    #authContainer { display: flex; align-items: center; height: 100%; }
    .auth-btn {
      background: var(--primary-blue); color: white; border: none;
      padding: 0 16px; height: 28px; border-radius: 14px;
      cursor: pointer; font-size: 12px; margin-right: 4px;
    }
    .auth-btn:hover { background: #0077e6; }
    .user-name { color: #121212; margin-right: 8px; }
    .logout-btn { color: var(--text-sub); cursor: pointer; margin-right: 10px; }
    .logout-btn:hover { color: var(--text-main); }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 600px) {
      .user-bar { position: relative; top: auto; right: auto; margin-bottom: 20px; width: auto; justify-content: center; flex-wrap: nowrap; }
      .content-wrapper { margin-top: 10px; }
    }

    /* --- ç™»å½•æ¡† --- */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
    .modal-box { background: #fff; padding: 30px; border-radius: 12px; width: 300px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; }
    .modal-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; outline: none; background: #f9f9f9; }
    .modal-box button { width: 100%; padding: 10px; border: none; border-radius: 6px; cursor: pointer; margin-top: 5px; font-weight: 500; }
    .btn-login { background: var(--primary-blue); color: #fff; margin-bottom: 10px; }

    /* --- ä¸»å¸ƒå±€ --- */
    .content-wrapper { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; max-width: 1000px; padding-bottom: 50px; margin-top: 60px; }
    .logo-container { margin-bottom: 40px; text-align: center; width: 100%; }
    .logo { width: 80%; max-width: 300px; height: auto; display: block; margin: 0 auto; }
    .logo-text { font-size: 36px; font-weight: 800; color: var(--primary-blue); display: none; }

    .search-container { width: 100%; max-width: 650px; margin-bottom: 30px; }
    .search-box { display: flex; align-items: center; background: #fff; border: 1px solid #e0e0e0; border-radius: 50px; padding: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); transition: all 0.3s; }
    .search-box:focus-within { border-color: var(--primary-blue); box-shadow: 0 4px 15px rgba(0, 132, 255, 0.15); }
    #searchInput { flex: 1; height: 44px; border: none; background: transparent; outline: none; font-size: 16px; padding: 0 20px; color: #222; }
    #searchButton { background-color: var(--primary-blue); color: white; border: none; height: 44px; padding: 0 32px; border-radius: 40px; cursor: pointer; font-size: 15px; font-weight: 500; }

    .quick-nav { display: flex; justify-content: center; gap: 30px; margin-bottom: 40px; width: 100%; max-width: 850px; flex-wrap: wrap; }
    .nav-item { display: flex; align-items: center; text-decoration: none; color: #646464; font-size: 14px; padding: 8px 12px; border-radius: 8px; transition: all 0.2s; cursor: pointer; }
    .nav-item:hover { background: #fff; color: var(--primary-blue); transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .nav-item i { margin-right: 8px; color: #999; }
    .nav-item:hover i { color: var(--primary-blue); }

    .toggle-section { width: 100%; text-align: center; display: flex; justify-content: center; gap: 20px; }
    .toggle-btn { background: #fff; border: 1px solid #eee; color: #999; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; font-size: 16px; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: inline-flex; align-items: center; justify-content: center; position: relative; }
    .toggle-btn:hover { color: var(--primary-blue); border-color: var(--primary-blue); transform: translateY(-2px); }
    .toggle-btn.active { background: var(--primary-blue); border-color: var(--primary-blue); color: white; }
    .toggle-btn.running::after { content: ''; position: absolute; top: 0; right: 0; width: 12px; height: 12px; background: #4caf50; border: 2px solid #fff; border-radius: 50%; }

    .hidden-wrapper { width: 100%; max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); margin-top: 0; }
    .hidden-wrapper.open { opacity: 1; margin-top: 30px; }

    /* é€šç”¨å·¥å…· & éŸ³ä¹ & æ¸¸æˆæ ·å¼ä¿æŒä¸å˜ */
    .grid-limit { max-width: 900px; } .grid-limit.open { max-height: 1000px; }
    .tools-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(105px, 1fr)); gap: 12px; }
    .tool-item { background: #fff; color: #666; text-decoration: none; text-align: center; padding: 15px 5px; font-size: 13px; border: 1px solid #f0f0f0; border-radius: 6px; }

    .music-limit { max-width: 500px; overflow: visible; } .music-limit.open { max-height: 400px; }
    .music-player { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--border-color); border-radius: 20px; padding: 25px; display: flex; align-items: center; gap: 25px; box-shadow: 0 10px 40px -10px rgba(0, 132, 255, 0.15); }
    .album-art { width: 110px; height: 110px; border-radius: 50%; overflow: hidden; border: 4px solid #fff; }
    .album-art img { width: 100%; height: 100%; object-fit: cover; animation: rotateArt 10s linear infinite; animation-play-state: paused; }
    @keyframes rotateArt { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .player-info { flex: 1; }
    .controls { display: flex; align-items: center; gap: 20px; margin-top: 10px; }
    .play-pause-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--primary-blue); color: #fff; border: none; cursor: pointer; }

    .game-limit { max-width: 650px; width: 100%; } .game-limit.open { max-height: 800px; }
    .game-container { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--border-color); border-radius: 20px; padding: 0; overflow: hidden; height: 320px; display: flex; position: relative; }
    .game-scene { flex: 2; position: relative; background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 50%, #4FC3F7 50%, #0288D1 100%); border-right: 1px solid rgba(255,255,255,0.5); overflow: hidden; }
    .game-cat { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); font-size: 60px; z-index: 10; cursor: pointer; transition: transform 0.2s; }
    .fishing-line { position: absolute; top: 120px; left: calc(50% + 25px); width: 2px; height: 0; background: #555; transform-origin: top center; transition: height 0.5s ease-out; }
    .fishing-line.casting { height: 120px; }
    .bobber { position: absolute; bottom: -10px; left: -4px; width: 10px; height: 10px; background: red; border-radius: 50%; display: none; }
    .fishing-line.casting .bobber { display: block; animation: bobbing 1s infinite alternate; }
    @keyframes bobbing { from { transform: translateY(0); } to { transform: translateY(5px); } }
    .alert-icon { position: absolute; top: 60px; left: calc(50% + 40px); font-size: 30px; color: #ff5252; font-weight: bold; opacity: 0; transition: opacity 0.2s; }
    .alert-icon.show { opacity: 1; animation: bounce 0.5s infinite; }
    .game-log-panel { flex: 1; background: rgba(255,255,255,0.5); padding: 15px; display: flex; flex-direction: column; font-size: 13px; color: #555; }
    .log-header { font-weight: bold; margin-bottom: 10px; color: var(--primary-blue); display: flex; flex-direction: column; gap: 8px; }
    .game-controls { display: flex; gap: 5px; }
    .btn-game-ctrl { flex: 1; padding: 6px 0; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; color: white; transition: opacity 0.2s; }
    .btn-start { background: #4caf50; }
    .btn-stop { background: #ff9800; display: none; }
    .log-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; font-family: monospace; border-top: 1px solid #eee; padding-top: 5px; }
    .log-item { animation: fadeIn 0.3s; font-size: 12px; }
    .log-item.rare { color: #e91e63; font-weight: bold; }
    .game-status-text { margin-top: 5px; font-size: 12px; color: #888; text-align: center; }

    /* --- ä»»åŠ¡æ¸…å• (ä¿®å¤éƒ¨åˆ†) --- */
    .task-limit { max-width: 650px; width: 100%; } 
    .task-limit.open { max-height: 800px; }
    .task-container {
      background: var(--glass-bg); backdrop-filter: blur(16px);
      border: 1px solid var(--border-color); border-radius: 20px;
      padding: 25px; box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08);
      display: flex; flex-direction: column; gap: 20px;
    }
    .task-input-group { display: flex; gap: 10px; align-items: center; }
    .task-input { flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 10px; outline: none; transition: border 0.2s; }
    .task-input:focus { border-color: var(--primary-blue); }
    .star-select { display: flex; gap: 5px; cursor: pointer; user-select: none; }
    .star-select i { color: #ddd; font-size: 18px; padding: 2px; transition: color 0.1s; }
    .star-select i.selected { color: #f1c40f; }
    .star-select:hover i { color: #f1c40f; } 
    .star-select i:hover ~ i { color: #ddd; }
    .btn-add-task { background: var(--primary-blue); color: white; border: none; width: 40px; height: 40px; border-radius: 10px; cursor: pointer; font-size: 16px; flex-shrink: 0; }
    .btn-add-task:hover { background: #0066cc; }
    .task-list { max-height: 350px; overflow-y: auto; padding-right: 5px; }
    .task-list::-webkit-scrollbar { width: 4px; }
    .task-list::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    .task-item {
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(255,255,255,0.6);
      border: 1px solid #eee; border-radius: 12px;
      padding: 12px 15px; margin-bottom: 10px; transition: all 0.3s;
    }
    .task-item:hover { transform: translateX(2px); border-color: var(--primary-blue); background: #fff; }
    .task-item.active-running { border-color: var(--primary-blue); background: rgba(0, 132, 255, 0.06); }
    .t-info { flex: 1; display: flex; flex-direction: column; gap: 2px; overflow: hidden; }
    .t-title { font-size: 14px; font-weight: 500; color: #333; }
    .t-stars { font-size: 12px; color: #f1c40f; }
    .t-timer { font-family: monospace; font-size: 14px; color: #555; margin: 0 15px; min-width: 70px; text-align: right; }
    .t-actions { display: flex; gap: 8px; }
    .btn-icon { width: 32px; height: 32px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 12px; }
    .btn-play { background: #e3f2fd; color: var(--primary-blue); }
    .btn-pause { background: var(--primary-blue); color: #fff; }
    .btn-del { background: transparent; color: #ccc; }
    .btn-del:hover { color: #ff5252; background: #fff0f0; }
    .empty-tip { text-align: center; color: #999; font-size: 13px; margin-top: 10px; }

    .hot-limit { max-width: 600px; } .hot-limit.open { max-height: 500px; }
    .hot-box { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden; height: 400px; display: flex; flex-direction: column; }
    iframe { width: 100%; height: 100%; border: none; }

    .footer { font-size: 12px; color: #ccc; margin-top: auto; padding-top: 20px; text-align: center; }
  </style>
</head>
<body>

  <!-- ç”¨æˆ·çŠ¶æ€æ  (çŸ¥ä¹æç®€é£) -->
  <div class="user-bar">
    <div class="fish-stats" title="é’“é±¼è¿›åº¦">
      <span id="levelBadge" class="level-badge">Lv.1</span>
      <span id="levelTitle">èœé¸Ÿ</span>
      <i class="fas fa-fish" style="color:var(--primary-blue); font-size:12px;"></i>
      <span id="userScore" style="font-family: monospace;">0</span>
    </div>
    <div class="divider"></div>
    <div id="authContainer">
      <button class="auth-btn" id="loginBtn" onclick="showAuthModal()">ç™»å½•</button>
      <div id="userInfo" style="display:none; align-items:center;">
        <span id="userNameDisplay" class="user-name"></span>
        <span class="logout-btn" onclick="handleLogout()">é€€å‡º</span>
      </div>
    </div>
  </div>

  <!-- ç™»å½•æ¡† -->
  <div class="modal-overlay" id="authModal">
    <div class="modal-box">
      <h3 style="margin-bottom:20px; color:#333;">ä½•å²©é€šè¡Œè¯</h3>
      <input type="text" id="username" class="modal-input" placeholder="ç”¨æˆ·å" autocomplete="off">
      <input type="password" id="password" class="modal-input" placeholder="å¯†ç ">
      <button class="btn-login" onclick="handleLogin()">ç™»å½• / æ³¨å†Œ</button>
      <button style="background:transparent; color:#8590a6;" onclick="closeAuthModal()">å–æ¶ˆ</button>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="logo-container">
      <img src="img/logo1.png" alt="Logo" class="logo" onerror="this.style.display='none';document.querySelector('.logo-text').style.display='inline-block'">
      <div class="logo-text">HE YAN</div>
    </div>

    <div class="search-container">
      <form action="https://www.baidu.com/s" method="get" class="search-box">
        <input type="text" id="searchInput" name="wd" placeholder="æœ‰é—®é¢˜ï¼Œå°±ä¼šæœ‰ç­”æ¡ˆ..." required autocomplete="off">
        <button type="submit" id="searchButton">æœç´¢</button>
      </form>
    </div>

    <div class="quick-nav">
      <a href="https://mp.weixin.qq.com/s?__biz=MzkyODM5OTgzMg==&mid=2247488236&idx=1&sn=b40d9af805b779de05b372b43a05c094" class="nav-item">
        <i class="far fa-clock"></i> <span id="dynamic-info" class="fade-anim">Loading...</span>
      </a>
      <a href="https://heyan9.github.io/è®°å½•.html" class="nav-item"><i class="fas fa-briefcase"></i> è®°å½•</a>
      <a href="https://500px.com.cn/heyanw" class="nav-item"><i class="fas fa-camera"></i> æ‘„å½±å±•ç¤º</a>
      <a href="https://www.tboxn.com/1504.html" class="nav-item"><i class="fas fa-book-open"></i> è¯»ä¹¦ç¬”è®°</a>
      
      <!-- éšæœºéª°å­ -->
      <div class="nav-item" onclick="rollDice(this)" title="ç‚¹å‡»æ‘‡éª°å­">
        <i class="fas fa-dice"></i> <span id="diceText">éšæœºéª°å­</span>
      </div>
    </div>

    <!-- å·¥å…·æ  -->
    <div class="toggle-section">
      <button class="toggle-btn" id="btnTools" onclick="toggleSection('tools')"><i class="fas fa-chevron-down"></i></button>
      <button class="toggle-btn" id="btnMusic" onclick="toggleSection('music')"><i class="fas fa-music"></i></button>
      <button class="toggle-btn" id="btnTasks" onclick="toggleSection('tasks')"><i class="fas fa-tasks"></i></button>
      <button class="toggle-btn" id="btnGame" onclick="toggleSection('game')"><i class="fas fa-fish"></i></button>
      <button class="toggle-btn" id="btnHot" onclick="toggleSection('hot')"><i class="fab fa-weibo"></i></button>
    </div>

    <!-- ç½‘å€å¯¼èˆª -->
    <div class="hidden-wrapper grid-limit" id="toolsWrapper">
      <div class="tools-grid">
        <a href="https://heyan9.github.io/heyanzuocai.html" class="tool-item">åšèœåŠ©æ‰‹</a>
        <a href="https://www.yikm.net/" class="tool-item">åœ¨çº¿æ¸¸æˆ</a>
        <a href="https://aistudio.google.com/" class="tool-item">è°·æ­Œç¼–ç¨‹ai</a>
        <a href="https://www.doubao.com/chat/" class="tool-item">è±†åŒ… AI</a>
        <a href="https://www.52pojie.cn/" class="tool-item">å¾çˆ±ç ´è§£</a>
        <a href="https://www.toutiao.com/" class="tool-item">ä»Šæ—¥å¤´æ¡</a>
        <a href="https://www.google.com.hk/" class="tool-item">Google</a>
        <a href="https://www.88mv.org/?ref=88ys.cn" class="tool-item">88å½±è§†</a>
        <a href="http://m.dodoge.me/" class="tool-item">Mç«™</a>
        <a href="https://www.66yingshi.com/" class="tool-item">è§†é¢‘BT</a>
        <a href="https://waifu2x.udp.jp/" class="tool-item">Waifu2x</a>
        <a href="https://www.dxomark.com/" class="tool-item">DXOmark</a>
        <a href="https://bbs.fengniao.com/forum/forum_125.html" class="tool-item">èœ‚é¸Ÿæ‘„å½±</a>
        <a href="https://clipdrop.co/uncrop" class="tool-item">AI æ‹“å›¾</a>
        <a href="https://github.com/" class="tool-item">Github</a>
        <a href="https://pc.woozooo.com/" class="tool-item">è“å¥äº‘</a>
        <a href="https://www.123pan.com/" class="tool-item">123äº‘ç›˜</a>
        <a href="https://fanyi.youdao.com/index.html#/" class="tool-item">åœ¨çº¿ç¿»è¯‘</a>
        <a href="https://tv.cctv.com/live/index.shtml" class="tool-item">CCTVç›´æ’­</a>
        <a href="http://www.2t58.com/" class="tool-item">æ— æŸéŸ³ä¹</a>
        <a href="https://cn.uptodown.com/" class="tool-item">å®‰å“åº”ç”¨</a>
        <a href="https://mail.google.com/" class="tool-item">Gmail</a>
        <a href="https://heyan9.github.io/dongzuo.html" class="tool-item">éšæœºåŠ¨ä½œ</a>
        <a href="https://ttsmaker.cn/" class="tool-item">æ–‡æœ¬è½¬è¯­éŸ³</a>
        <a href="https://bento.me/freecloud" class="tool-item">å…è´¹æœºåœº</a>
        <a href="https://tianqi.moji.com/weather/china/hunan/miluo" class="tool-item">å¢¨è¿¹å¤©æ°”</a>
        <a href="https://wallpapercave.com/" class="tool-item">å£çº¸ä¸‹è½½</a>
        <a href="https://chat.chat826.com/#/home" class="tool-item">Chat8</a>
        <a href="https://weread.qq.com/web/shelf" class="tool-item">å¾®ä¿¡è¯»ä¹¦</a>
        <a href="https://www.ilovepdf.com/" class="tool-item">PDFè½¬æ¢</a>
        <a href="https://ucnrbg5e0s07.feishu.cn/minutes/home" class="tool-item">é£ä¹¦å¦™è®°</a>
        <a href="https://pdftoword.55.la/" class="tool-item">è½¬è½¬å¤§å¸ˆ</a>
        <a href="https://koodo.960960.xyz/zh" class="tool-item">Koodo</a>
        <a href="https://zh.z-library.se/" class="tool-item">Z-Library</a>
        <a href="https://www.hzlib.net/szzyxsyj/364.htm" class="tool-item">çŸ¥ç½‘ä¸‹è½½</a>
        <a href="https://onlinecamscanner.com/zh-Hans/" class="tool-item">åœ¨çº¿æ‰«æ</a>
        <a href="https://vocalremover.org/zh/" class="tool-item">åˆ†ç¦»äººå£°</a>
        <a href="https://xvideos.com/" class="tool-item">XV</a>
        <a href="https://note.youdao.com/s/NuYFD6yL" class="tool-item">æ¸¸æˆç›’</a>
      </div>
    </div>

    <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
    <div class="hidden-wrapper music-limit" id="musicWrapper">
      <div class="music-player">
        <div class="album-art"><img src="" alt="Cover" id="musicCover"></div>
        <div class="player-info">
          <div class="song-title" id="musicTitle"></div>
          <div class="artist-name" id="musicArtist"></div>
          <div class="controls">
            <button class="ctrl-btn" onclick="prevSong()"><i class="fas fa-step-backward"></i></button>
            <button class="play-pause-btn" onclick="togglePlay()"><i class="fas fa-play" id="playIcon"></i></button>
            <button class="ctrl-btn" onclick="nextSong()"><i class="fas fa-step-forward"></i></button>
          </div>
        </div>
        <audio id="audioPlayer"></audio>
      </div>
    </div>

    <!-- å°çŒ«é’“é±¼ -->
    <div class="hidden-wrapper game-limit" id="gameWrapper">
      <div class="game-container">
        <div class="game-scene">
          <div class="alert-icon" id="gameAlert">!</div>
          <div class="game-cat" id="catSprite">ğŸ±</div>
          <div class="fishing-line" id="fishingLine"><div class="bobber"></div></div>
        </div>
        <div class="game-log-panel">
          <div class="log-header">
            <span><i class="fas fa-history"></i> æŒ‚æœºæ—¥å¿—</span>
            <div class="game-controls">
              <button class="btn-game-ctrl btn-start" id="btnStartGame" onclick="userStartGame()"><i class="fas fa-play"></i> å¼€å§‹æŒ‚æœº</button>
              <button class="btn-game-ctrl btn-stop" id="btnStopGame" onclick="userStopGame()"><i class="fas fa-pause"></i> æš‚åœ</button>
            </div>
          </div>
          <div class="log-list" id="gameLog">
            <div class="log-item">æ¬¢è¿ï¼ç‚¹å‡»[å¼€å§‹æŒ‚æœº]å¯åŠ¨è‡ªåŠ¨é’“é±¼ã€‚</div>
            <div class="log-item">é¢æ¿æ”¶èµ·åæ¸¸æˆä»ä¼šåœ¨åå°è¿è¡Œã€‚</div>
          </div>
          <div class="game-status-text" id="gameStatus">çŠ¶æ€: ä¼‘æ¯ä¸­</div>
        </div>
      </div>
    </div>

    <!-- ä»»åŠ¡æ¸…å• (å·²ä¿®å¤) -->
    <div class="hidden-wrapper task-limit" id="tasksWrapper">
      <div class="task-container">
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="task-input-group">
          <input type="text" id="newTaskInput" class="task-input" placeholder="è¾“å…¥æ–°ä»»åŠ¡ (ç™»å½•åå¯åŒæ­¥)...">
          
          <div class="star-select" id="newStarSelect">
            <i class="fas fa-star selected" onclick="setStar(1)"></i>
            <i class="fas fa-star selected" onclick="setStar(2)"></i>
            <i class="fas fa-star selected" onclick="setStar(3)"></i>
            <i class="fas fa-star" onclick="setStar(4)"></i>
            <i class="fas fa-star" onclick="setStar(5)"></i>
          </div>
          
          <button class="btn-add-task" onclick="addNewTask()"><i class="fas fa-plus"></i></button>
        </div>
        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div class="task-list" id="taskListContainer">
          <div class="empty-tip">æš‚æ— ä»»åŠ¡ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ </div>
        </div>
      </div>
    </div>

    <!-- å¾®åšçƒ­æœ -->
    <div class="hidden-wrapper hot-limit" id="hotWrapper">
      <div class="hot-box">
        <iframe src="https://s.weibo.com/top/summary?cate=realtimehot"></iframe>
      </div>
    </div>

  </div>

  <div class="footer">Created by He Yan | Â© 2025 12 | <span id="syncStatus">äº‘ç«¯æœªè¿æ¥</span></div>

<script>
  // LeanCloud Config
  const APP_ID = "vcJyhwqg1HpbKXiLUvLHzFIh-gzGzoHsz";
  const APP_KEY = "hknbmRcwH2bJDcqxRvLR67mk";
  const SERVER_URL = "https://vcjyhwqg.lc-cn-n1-shared.com";

  let isCloudEnabled = false;
  try {
    if (APP_ID) {
      AV.init({ appId: APP_ID, appKey: APP_KEY, serverURL: SERVER_URL });
      isCloudEnabled = true;
      document.getElementById('syncStatus').innerText = "äº‘ç«¯å·²è¿æ¥";
      document.getElementById('syncStatus').style.color = "#4caf50";
    }
  } catch (e) { console.error("LC Init", e); }

  // User System
  let currentUser = null;
  let userGameScore = 0;

  if (isCloudEnabled) {
    currentUser = AV.User.current();
    if (currentUser) {
      updateUIForLogin(currentUser);
      syncUserData();
      loadTasksFromCloud();
    }
  }

  function showAuthModal() { document.getElementById('authModal').style.display = 'flex'; }
  function closeAuthModal() { document.getElementById('authModal').style.display = 'none'; }
  function handleLogout() { if(confirm("é€€å‡ºç™»å½•ï¼Ÿ")) { AV.User.logOut(); window.location.reload(); } }

  async function handleLogin() {
    const u = document.getElementById('username').value.trim();
    const p = document.getElementById('password').value.trim();
    if(!u || !p) return;
    try {
      currentUser = await AV.User.logIn(u, p);
      closeAuthModal(); updateUIForLogin(currentUser); 
      syncUserData(); loadTasksFromCloud();
    } catch (e) {
      if(e.code===211||e.code===210) {
        const user=new AV.User(); user.setUsername(u); user.setPassword(p);
        user.set('gameScore',0);
        try{ currentUser=await user.signUp(); closeAuthModal(); updateUIForLogin(currentUser); }
        catch(re){ alert(re.message); }
      } else alert(e.message);
    }
  }

  function updateUIForLogin(user) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('userInfo').style.display = 'flex';
    document.getElementById('userNameDisplay').innerText = user.getUsername();
  }

  // Dice Logic
  function rollDice(el) {
    const val = Math.floor(Math.random() * 6) + 1;
    const textSpan = el.querySelector('span');
    textSpan.innerText = `ç‚¹æ•°: ${val}`;
    const icon = el.querySelector('i');
    const numWords = ['one', 'two', 'three', 'four', 'five', 'six'];
    icon.className = `fas fa-dice-${numWords[val-1]}`;
    el.style.color = "var(--primary-blue)";
    setTimeout(() => { el.style.color = ""; }, 500);
  }

  // Level Logic
  function calculateLevelInfo(score) {
    const level = Math.floor(score / 50) + 1; 
    let title = "èœé¸Ÿ";
    if (level > 500) title = "é’“ç¥";
    else if (level > 100) title = "å¤§å¸ˆ";
    else if (level > 60) title = "è€æ‰‹";
    else if (level > 30) title = "å…¥é—¨";
    else if (level > 15) title = "æ–°æ‰‹";
    return { level, title };
  }
  function updateScoreDisplay() {
    const info = calculateLevelInfo(userGameScore);
    document.getElementById('userScore').innerText = userGameScore;
    document.getElementById('levelBadge').innerText = `Lv.${info.level}`;
    document.getElementById('levelTitle').innerText = info.title;
  }
  async function syncUserData() {
    if(!currentUser) return;
    await currentUser.fetch();
    userGameScore = currentUser.get('gameScore') || 0;
    updateScoreDisplay();
  }

  // --- Task Logic (Restored) ---
  const TodoItem = AV.Object.extend('TodoItem');
  let tasks = []; 
  let currentTaskNewStars = 3; 
  let activeTaskId = null; 
  let taskTimerInterval = null; 
  let taskStartTime = 0; 

  function setStar(val) {
    currentTaskNewStars = val;
    const stars = document.getElementById('newStarSelect').children;
    for(let i=0; i<5; i++) {
      if(i < val) stars[i].classList.add('selected');
      else stars[i].classList.remove('selected');
    }
  }

  async function loadTasksFromCloud() {
    if(!currentUser) return;
    const query = new AV.Query('TodoItem');
    query.equalTo('user', currentUser);
    query.descending('stars');
    try {
      const results = await query.find();
      tasks = results.map(item => ({
        id: item.id,
        title: item.get('title'),
        stars: item.get('stars'),
        totalSeconds: item.get('totalSeconds') || 0,
        obj: item 
      }));
      renderTasks();
    } catch(e) { console.error("Load Tasks Error", e); }
  }

  async function addNewTask() {
    if(!currentUser) return alert("è¯·å…ˆç™»å½•ï¼");
    const input = document.getElementById('newTaskInput');
    const title = input.value.trim();
    if(!title) return;

    const todo = new TodoItem();
    todo.set('title', title);
    todo.set('stars', currentTaskNewStars);
    todo.set('totalSeconds', 0);
    todo.set('user', currentUser);
    
    try {
      const saved = await todo.save();
      tasks.unshift({ 
        id: saved.id, title: title, stars: currentTaskNewStars,
        totalSeconds: 0, obj: saved
      });
      tasks.sort((a,b) => b.stars - a.stars);
      renderTasks();
      input.value = '';
    } catch(e) { alert("æ·»åŠ å¤±è´¥: " + e.message); }
  }

  async function deleteTask(event, id) {
    event.stopPropagation();
    if(!confirm("ç¡®å®šåˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ")) return;
    if(activeTaskId === id) toggleTaskTimer(id);
    const taskIndex = tasks.findIndex(t => t.id === id);
    if(taskIndex > -1) {
      const taskObj = tasks[taskIndex].obj;
      tasks.splice(taskIndex, 1);
      renderTasks();
      try { await taskObj.destroy(); } catch(e) { console.error("Delete Error", e); }
    }
  }

  function toggleTaskTimer(id) {
    const task = tasks.find(t => t.id === id);
    if(!task) return;
    if(activeTaskId && activeTaskId !== id) stopTaskTimer(activeTaskId);
    if(activeTaskId === id) stopTaskTimer(id);
    else startTaskTimer(id);
  }

  function startTaskTimer(id) {
    activeTaskId = id;
    taskStartTime = Date.now();
    renderTasks(); 
    taskTimerInterval = setInterval(() => {
      const el = document.getElementById(`timer-${id}`);
      if(el) {
        const currentSessionSecs = Math.floor((Date.now() - taskStartTime) / 1000);
        const task = tasks.find(t => t.id === id);
        el.innerText = formatTime(task.totalSeconds + currentSessionSecs);
      }
    }, 1000);
  }

  function stopTaskTimer(id) {
    clearInterval(taskTimerInterval);
    const task = tasks.find(t => t.id === id);
    if(task) {
      const sessionSecs = Math.floor((Date.now() - taskStartTime) / 1000);
      task.totalSeconds += sessionSecs;
      task.obj.set('totalSeconds', task.totalSeconds);
      task.obj.save();
    }
    activeTaskId = null;
    renderTasks();
  }

  function formatTime(totalSeconds) {
    const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
    const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
    const s = (totalSeconds % 60).toString().padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function renderTasks() {
    const container = document.getElementById('taskListContainer');
    if(tasks.length === 0) {
      container.innerHTML = '<div class="empty-tip">æš‚æ— ä»»åŠ¡ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ </div>';
      return;
    }
    let html = '';
    tasks.forEach(t => {
      const isRunning = (t.id === activeTaskId);
      const starsStr = 'â˜…'.repeat(t.stars);
      const btnClass = isRunning ? 'btn-pause' : 'btn-play';
      const btnIcon = isRunning ? 'fa-pause' : 'fa-play';
      const activeClass = isRunning ? 'active-running' : '';
      html += `
        <div class="task-item ${activeClass}">
          <div class="t-info">
            <div class="t-title" title="${t.title}">${t.title}</div>
            <div class="t-stars">${starsStr}</div>
          </div>
          <div class="t-timer" id="timer-${t.id}">${formatTime(t.totalSeconds)}</div>
          <div class="t-actions">
            <button class="btn-icon ${btnClass}" onclick="toggleTaskTimer('${t.id}')">
              <i class="fas ${btnIcon}"></i>
            </button>
            <button class="btn-icon btn-del" onclick="deleteTask(event, '${t.id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
    });
    container.innerHTML = html;
  }

  // Game Logic
  let isGameRunning = false;
  let gameTimer = null;
  const gameState = {
    fishes: [
      { name: "è‰é±¼", prob: 0.45, score: 5 },
      { name: "é”¦é²¤", prob: 0.25, score: 12 },
      { name: "é‡‘æªé±¼", prob: 0.15, score: 30 },
      { name: "ç¥ç§˜å®ç®±", prob: 0.05, score: 100 },
      { name: "ç ´é´å­", prob: 0.10, score: 1 }
    ]
  };

  function userStartGame() {
    if(isGameRunning) return;
    isGameRunning = true;
    updateGameUIState();
    updateGameStatus("æŒ‚æœºå·²å¯åŠ¨...");
    nextGameAction();
  }
  function userStopGame() {
    isGameRunning = false;
    clearTimeout(gameTimer);
    updateGameUIState();
    updateGameStatus("æŒ‚æœºå·²æš‚åœ");
    document.getElementById('fishingLine').classList.remove('casting');
    document.getElementById('gameAlert').classList.remove('show');
  }
  function updateGameUIState() {
    const btnStart = document.getElementById('btnStartGame');
    const btnStop = document.getElementById('btnStopGame');
    const toggleBtn = document.getElementById('btnGame');
    if(isGameRunning) {
      btnStart.style.display = 'none'; btnStop.style.display = 'inline-block';
      toggleBtn.classList.add('running');
    } else {
      btnStart.style.display = 'inline-block'; btnStop.style.display = 'none';
      toggleBtn.classList.remove('running');
    }
  }
  function updateGameStatus(text) { document.getElementById('gameStatus').innerText = `${text}`; }
  function addGameLog(text, isRare) {
    const logDiv = document.getElementById('gameLog');
    const div = document.createElement('div');
    div.className = 'log-item' + (isRare ? ' rare' : '');
    const time = new Date().toLocaleTimeString('zh-CN', {hour12:false, minute:'2-digit', second:'2-digit'});
    div.innerText = `[${time}] ${text}`;
    logDiv.appendChild(div); logDiv.scrollTop = logDiv.scrollHeight;
  }
  function nextGameAction() { if (!isGameRunning) return; gameTimer = setTimeout(castLine, 2000 + Math.random() * 3000); }
  function castLine() { if (!isGameRunning) return; updateGameStatus("æŠ›ç«¿ä¸­..."); document.getElementById('fishingLine').classList.add('casting'); gameTimer = setTimeout(fishBite, 3000 + Math.random() * 4000); }
  function fishBite() { if (!isGameRunning) return; updateGameStatus("æœ‰é±¼ä¸Šé’©ï¼"); document.getElementById('gameAlert').classList.add('show'); gameTimer = setTimeout(reelIn, 1000); }
  async function reelIn() {
    if (!isGameRunning) return;
    document.getElementById('fishingLine').classList.remove('casting');
    document.getElementById('gameAlert').classList.remove('show');
    const r = Math.random();
    let acc = 0; let caught = gameState.fishes[0];
    for (let f of gameState.fishes) { acc += f.prob; if (r < acc) { caught = f; break; } }
    userGameScore += caught.score; updateScoreDisplay();
    addGameLog(`é’“åˆ°äº† ${caught.name}! +${caught.score}åˆ†`, caught.score >= 30);
    updateGameStatus(`æ”¶è·: ${caught.name}`);
    if (currentUser) { currentUser.increment('gameScore', caught.score); try { await currentUser.save(); } catch(e){ console.log("Save fail",e); } }
    nextGameAction();
  }

  // UI Toggles
  function toggleSection(type) {
    const ids = { tools: 'toolsWrapper', music: 'musicWrapper', tasks: 'tasksWrapper', game: 'gameWrapper', hot: 'hotWrapper' };
    const btns = { tools: 'btnTools', music: 'btnMusic', tasks: 'btnTasks', game: 'btnGame', hot: 'btnHot' };
    const targetEl = document.getElementById(ids[type]);
    const isOpen = targetEl.classList.contains('open');
    for(let k in ids) { document.getElementById(ids[k]).classList.remove('open'); document.getElementById(btns[k]).classList.remove('active'); }
    if(!isOpen) { targetEl.classList.add('open'); document.getElementById(btns[type]).classList.add('active'); }
  }

  // Music & Info
  const audio = document.getElementById('audioPlayer');
  function togglePlay() { if(audio.paused) { audio.play(); document.getElementById('playIcon').className='fas fa-pause'; } else { audio.pause(); document.getElementById('playIcon').className='fas fa-play'; } }
  const infoEl = document.getElementById('dynamic-info');
  setInterval(() => { const now=new Date(); infoEl.innerText = `${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`; }, 1000);
  const playlist = [{ title: "åœ¨æ°´ä¸€æ–¹", artist: "æå¥", src: "mp3/åœ¨æ°´ä¸€æ–¹.mp3", cover: "mp3/2.jpg" }, { title: "è¥¿ç•Œ", artist: "æ—ä¿Šæ°", src: "mp3/è¥¿ç•Œ.mp3", cover: "mp3/1.jpg" }];
  let curIdx = 0;
  function loadSong(s) { document.getElementById('musicTitle').innerText = s.title; document.getElementById('musicArtist').innerText = s.artist; audio.src = s.src; document.getElementById('musicCover').src = s.cover || 'img/logo1.png'; }
  loadSong(playlist[curIdx]);
  function prevSong() { curIdx--; if(curIdx<0) curIdx=playlist.length-1; loadSong(playlist[curIdx]); togglePlay(); }
  function nextSong() { curIdx++; if(curIdx>playlist.length-1) curIdx=0; loadSong(playlist[curIdx]); togglePlay(); }
  audio.addEventListener('ended', nextSong);

</script>
</body>
</html>
