<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¨çƒ¹é¥ªåŠ©æ‰‹ | KFCé£æ ¼ç‰ˆ</title>
    <style>
        :root {
            /* KFC é£æ ¼é…è‰² */
            --kfc-red: #C41230;       
            --kfc-red-hover: #a00f28; 
            --bg-body: #f7f7f7;       
            --glass-bg: rgba(255, 255, 255, 0.95); 
            --text-main: #333333;     
            --text-sub: #666666;      
            --shadow-red: 0 8px 20px rgba(196, 18, 48, 0.15);
            --radius-box: 16px;
            --star-gold: #ffc107;
        }

        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: radial-gradient(circle at top right, rgba(196, 18, 48, 0.05), transparent 40%),
                        linear-gradient(to bottom, #ffffff, #f2f2f2);
            color: var(--text-main);
            margin: 0;
            padding: 20px 15px;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 120px; /* åº•éƒ¨ç•™ç©ºç»™æ‚¬æµ®æ  */
        }

        /* é¡¶éƒ¨ Logo æ  */
        .header-box {
            text-align: center;
            margin-bottom: 20px;
        }
        .brand-img {
            height: 60px; /* æ§åˆ¶Logoé«˜åº¦ */
            width: auto;
            display: block;
            margin: 0 auto;
        }
        /* å¤‡ç”¨æ–‡å­—Logoï¼ˆé˜²æ­¢å›¾ç‰‡åŠ è½½å¤±è´¥ï¼‰ */
        .brand-text-fallback {
            display: none;
            font-size: 24px;
            font-weight: 900;
            color: var(--kfc-red);
            font-style: italic;
        }

        /* æ¯›ç»ç’ƒä¸»å®¹å™¨ */
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 1);
            border-radius: var(--radius-box);
            padding: 25px 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            min-height: 60vh;
        }

        /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */
        .page { display: none; animation: fadeIn 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 {
            font-size: 18px;
            color: #000;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 800;
            letter-spacing: 1px;
        }
        
        /* --- æ’è¡Œæ¦œå¡ç‰‡ --- */
        .rank-card {
            background: #fff;
            border: 1px solid #ffebeb;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(196, 18, 48, 0.05);
        }
        .rank-title {
            font-size: 14px;
            color: var(--kfc-red);
            font-weight: 900;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .rank-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            font-size: 13px;
        }
        .rank-item:last-child { border-bottom: none; }
        .rank-badge {
            background: var(--kfc-red);
            color: white;
            width: 18px;
            height: 18px;
            line-height: 18px;
            text-align: center;
            border-radius: 4px;
            font-size: 10px;
            margin-right: 8px;
            font-weight: bold;
            display: inline-block;
        }
        .rank-score { color: var(--star-gold); font-weight: bold; }

        /* --- é€‰èœ/äººæ•°/æ¸…å• æ ·å¼ä¿æŒä¸€è‡´ --- */
        .people-btn {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .people-btn::after {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0; width: 6px;
            background: var(--kfc-red);
            transform: scaleY(0);
            transition: transform 0.2s;
        }
        .people-btn:hover, .people-btn.selected {
            border-color: var(--kfc-red);
            background: #fff5f6;
            box-shadow: var(--shadow-red);
        }
        .people-btn.selected::after { transform: scaleY(1); }
        .people-btn strong { font-size: 18px; color: #333; }
        .people-btn.selected strong { color: var(--kfc-red); }

        .dish-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            padding-bottom: 20px;
        }
        .dish-check { display: none; }
        .dish-card {
            background: #fff;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
            color: #444;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            position: relative;
        }
        .dish-check:checked + .dish-card {
            border-color: var(--kfc-red);
            color: var(--kfc-red);
            background: #fff;
            box-shadow: 0 4px 12px rgba(196, 18, 48, 0.15);
        }
        .dish-check:checked + .dish-card::before {
            content: 'âœ”';
            position: absolute;
            top: -1px; right: -1px;
            background: var(--kfc-red);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-bottom-left-radius: 8px;
            border-top-right-radius: 10px;
        }

        .shop-list li {
            background: #fff;
            border-bottom: 1px dashed #ddd;
            padding: 15px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dish-label { font-size: 12px; background: #333; color: #fff; padding: 2px 6px; border-radius: 4px; margin-right: 8px;}
        .ing-amount { color: var(--kfc-red); font-weight: bold; font-family: Arial, sans-serif; font-size: 16px; }
        
        .pantry-box { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #666; color: #666; font-size: 13px; }

        .recipe-card { background: #fff; border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #eee; }
        .recipe-header { border-bottom: 2px solid var(--kfc-red); padding-bottom: 10px; margin-bottom: 15px; font-size: 18px; font-weight: 900; color: #000; }
        .step-row { display: flex; margin-bottom: 15px; font-size: 15px; color: #333; }
        .step-idx { min-width: 24px; height: 24px; background: var(--kfc-red); color: #fff; border-radius: 50%; text-align: center; line-height: 24px; font-size: 12px; font-weight: bold; margin-right: 12px; margin-top: 2px; flex-shrink: 0; }
        .time-mark { color: var(--kfc-red); font-weight: 800; background: #fff0f2; padding: 0 4px; border-radius: 4px; }

        /* --- æ‰“åˆ†ç³»ç»Ÿ --- */
        .rating-section {
            margin-top: 30px;
            border-top: 1px dashed #ddd;
            padding-top: 20px;
        }
        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            background: #fdfdfd;
            padding: 10px;
            border-radius: 8px;
        }
        .rating-name { font-weight: bold; font-size: 14px; }
        .stars-container { display: flex; gap: 5px; }
        .star-btn { 
            font-size: 20px; 
            color: #ddd; 
            cursor: pointer; 
            transition: color 0.2s; 
        }
        .star-btn.active { color: var(--star-gold); }

        /* --- åº•éƒ¨ä¸Šæ¬¡è®°å½•æ¡ --- */
        .last-record-bar {
            position: fixed;
            bottom: 85px; /* åœ¨æŒ‰é’®æ ä¸Šæ–¹ */
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.8);
            color: #fff;
            font-size: 12px;
            padding: 8px;
            text-align: center;
            z-index: 900;
            backdrop-filter: blur(5px);
            display: none; /* é»˜è®¤éšè—ï¼Œæœ‰è®°å½•æ‰æ˜¾ç¤º */
        }

        /* --- åº•éƒ¨æ‚¬æµ®æŒ‰é’®æ  --- */
        .fixed-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px 25px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            z-index: 999;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .btn { border: none; border-radius: 50px; padding: 14px 20px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.1s; text-align: center; white-space: nowrap; }
        .btn:active { transform: scale(0.96); }
        .btn-main { background: var(--kfc-red); color: #fff; flex: 2; box-shadow: 0 4px 15px rgba(196, 18, 48, 0.3); }
        .btn-main:hover { background: var(--kfc-red-hover); }
        .btn-sub { background: #fff; border: 1px solid #ccc; color: #333; flex: 1; }
        .btn-copy { background: #333; color: #fff; flex: 1; }

        .footer-group { display: none; width: 100%; max-width: 600px; gap: 15px; }
        .footer-group.active { display: flex; }

    </style>
</head>
<body>

    <!-- Logo -->
    <div class="header-box">
        <img src="img/logo1.png" alt="COOKING MASTER" class="brand-img" onerror="this.style.display='none';document.getElementById('fallback-logo').style.display='block'">
        <!-- å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„å¤‡ç”¨æ–‡å­— -->
        <div id="fallback-logo" class="brand-text-fallback">COOKING MASTER</div>
    </div>

<div class="container">

    <!-- 1. äººæ•°é€‰æ‹©é¡µ -->
    <div id="page-people" class="page active">
        <h2>è¯·é€‰æ‹©ç”¨é¤äººæ•°</h2>
        
        <div onclick="selectPeople(1)" class="people-btn">
            <div><strong>ğŸ‘¤ 1 - 2 äºº</strong><span style="font-size:12px;color:#999;margin-left:10px;">ç²¾è‡´å°ä»½é‡</span></div>
            <span style="color:#ddd; font-size:20px;">âœ</span>
        </div>
        <div onclick="selectPeople(2)" class="people-btn">
            <div><strong>ğŸ‘¥ 3 - 4 äºº</strong><span style="font-size:12px;color:#999;margin-left:10px;">æ ‡å‡†å®¶åº­é¤</span></div>
            <span style="color:#ddd; font-size:20px;">âœ</span>
        </div>
        <div onclick="selectPeople(3)" class="people-btn">
            <div><strong>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ 4 - 8 äºº</strong><span style="font-size:12px;color:#999;margin-left:10px;">æœ‹å‹èšä¼šå¤§é¤</span></div>
            <span style="color:#ddd; font-size:20px;">âœ</span>
        </div>
    </div>

    <!-- 2. é€‰èœé¡µ (åŒ…å«æ’è¡Œæ¦œ) -->
    <div id="page-menu" class="page">
        <!-- æ’è¡Œæ¦œæ¡† -->
        <div class="rank-card" id="ranking-box" style="display:none;">
            <div class="rank-title">â­ å¤§å¨çƒ­é—¨æ¦œ Top 5</div>
            <ul class="rank-list" id="rank-list-content">
                <!-- JS å¡«å…… -->
            </ul>
        </div>

        <h2>ä»Šå¤©æƒ³åƒä»€ä¹ˆï¼Ÿ</h2>
        <p id="people-display-text" style="text-align:center; color:#C41230; font-weight:bold; margin-bottom:20px; font-size:14px;"></p>
        
        <div class="dish-grid" id="menu-grid">
            <!-- JS ç”Ÿæˆ -->
        </div>
        <div style="height: 60px;"></div>
    </div>

    <!-- 3. è´­ç‰©æ¸…å•é¡µ -->
    <div id="page-shop" class="page">
        <h2>é‡‡è´­æ¸…å•</h2>
        <ul class="shop-list" id="shop-main-list"></ul>
        <div class="pantry-box">
            <strong>ğŸ’¡ å®¶ä¸­å¸¸å¤‡:</strong>
            <p id="shop-seasoning-list" style="margin:5px 0 0 0"></p>
        </div>
        <div style="height: 60px;"></div>
    </div>

    <!-- 4. çƒ¹é¥ªæ­¥éª¤é¡µ (å«æ‰“åˆ†) -->
    <div id="page-cook" class="page">
        <h2>çƒ¹é¥ªå¼€å§‹</h2>
        <div id="recipe-container"></div>
        
        <!-- æ‰“åˆ†åŒºåŸŸ -->
        <div class="rating-section" id="rating-area">
            <h3 style="text-align:center; font-size:16px;">âœ¨ å®Œæˆäº†ï¼Ÿæ¥æ‰“ä¸ªåˆ†å§</h3>
            <div id="rating-list"></div>
        </div>

        <div style="height: 60px;"></div>
    </div>

</div>

<!-- åº•éƒ¨ä¸Šæ¬¡è®°å½• -->
<div id="last-record-bar" class="last-record-bar"></div>

<!-- åº•éƒ¨æ‚¬æµ®æŒ‰é’®åŒº -->
<div class="fixed-footer">
    <div id="footer-menu" class="footer-group">
        <button class="btn btn-sub" onclick="gotoPage('page-people')">è¿”å›</button>
        <button class="btn btn-main" onclick="gotoShop()">é€‰å¥½äº†ï¼Œä¸‹ä¸€æ­¥ âœ</button>
    </div>
    <div id="footer-shop" class="footer-group">
        <button class="btn btn-sub" onclick="gotoPage('page-menu')">ä¿®æ”¹</button>
        <button class="btn btn-copy" onclick="copyShoppingList()">å¤åˆ¶æ¸…å•</button>
        <button class="btn btn-main" onclick="gotoCook()">å¼€å§‹åšèœ âœ</button>
    </div>
    <div id="footer-cook" class="footer-group">
        <button class="btn btn-sub" onclick="gotoPage('page-shop')">çœ‹æ¸…å•</button>
        <button class="btn btn-main" onclick="finishAndSave()">ä¿å­˜è®°å½•å¹¶é‡ç½®</button>
    </div>
</div>

<script>
    // === æ•°æ®é€»è¾‘ ===
    let multiplier = 1; 
    let selectedDishIds = [];
    
    // æ¨¡æ‹Ÿäº‘ç«¯ï¼šæœ¬åœ°å­˜å‚¨Key
    const STORAGE_KEY_RATINGS = 'chef_pro_ratings'; 
    const STORAGE_KEY_LAST = 'chef_pro_last_record';

    // 41é“èœå“å®Œæ•´æ•°æ®
    const dishes = [
        { id: 1, name: "åœŸè±†çƒ§æ’éª¨", main: [{n:"æ’éª¨",q:400,u:"g"}, {n:"åœŸè±†",q:2,u:"ä¸ª"}], season: "å§œ,ç”ŸæŠ½,æ–™é…’,å†°ç³–,ç›", steps: ["æ’éª¨å†·æ°´ä¸‹é”…ç„¯æ°´3åˆ†é’Ÿæå‡º", "é”…çƒ­æ²¹åŒ–å†°ç³–ï¼Œä¸‹æ’éª¨ç‚’ç³–è‰²2åˆ†é’Ÿ", "åŠ ç”ŸæŠ½æ–™é…’æ°´æ²¡è¿‡é£Ÿæï¼Œç‚–30åˆ†é’Ÿ", "åŠ åœŸè±†å—å†ç‚–15åˆ†é’Ÿ", "åŠ ç›å¤§ç«æ”¶æ±2åˆ†é’Ÿ"] },
        { id: 2, name: "è¾£æ¤’ç‚’è‚‰", main: [{n:"äº”èŠ±è‚‰",q:200,u:"g"}, {n:"èºä¸æ¤’",q:4,u:"ä¸ª"}], season: "è’œ,ç”ŸæŠ½,è€æŠ½,è±†è±‰", steps: ["é’æ¤’åˆ‡å—å¹²é”…ç…¸ç‚’è‡³è™çš®çŠ¶(çº¦2åˆ†é’Ÿ)ç››å‡º", "çƒ­æ²¹ç‚’è‚‰ç‰‡è‡³å‡ºæ²¹å·æ›²(çº¦3åˆ†é’Ÿ)", "æ”¾è’œå’Œè±†è±‰çˆ†é¦™30ç§’", "å€’å…¥é’æ¤’ï¼ŒåŠ é…±æ²¹å¤§ç«æ··ç‚’1åˆ†é’Ÿ"] },
        { id: 3, name: "é…¸è¾£åœŸè±†ä¸", main: [{n:"åœŸè±†",q:2,u:"ä¸ª"}], season: "å¹²è¾£æ¤’,èŠ±æ¤’,è’œ,ç™½é†‹", steps: ["åœŸè±†åˆ‡ä¸æ³¡æ°´5åˆ†é’Ÿæ´—æ‰æ·€ç²‰", "çƒ­æ²¹çˆ†é¦™èŠ±æ¤’å¹²è¾£æ¤’è’œ20ç§’", "å¤§ç«å€’å…¥åœŸè±†ä¸å¿«ç‚’2åˆ†é’Ÿ", "æ·‹å…¥ç™½é†‹å’Œç›ç¿»ç‚’30ç§’å‡ºé”…"] },
        { id: 4, name: "å¥¶é»„åŒ…", main: [{n:"é€Ÿå†»å¥¶é»„åŒ…",q:1,u:"åŒ…"}], season: "æ°´", steps: ["æ— éœ€è§£å†»ï¼Œç›´æ¥æ”¾å…¥è’¸ç¬¼", "æ°´å¼€åä¸­ç«è’¸9åˆ†é’Ÿ", "å…³ç«ç„–2åˆ†é’Ÿå†æ­ç›–"] },
        { id: 5, name: "è€å§œç‚’é¸¡", main: [{n:"é¸¡è‚‰",q:500,u:"g"}, {n:"è€å§œ",q:150,u:"g"}], season: "è’œ,ç”ŸæŠ½,æ–™é…’,ç›", steps: ["é¸¡å—åŠ ç›æ–™é…’è…Œåˆ¶10åˆ†é’Ÿ", "çƒ­æ²¹ç‚¸ç‚’é¸¡å—è‡³é‡‘é»„(çº¦5åˆ†é’Ÿ)ç››å‡º", "åŸé”…çˆ†é¦™å¤§é‡å§œç‰‡2åˆ†é’Ÿ", "å›é”…é¸¡è‚‰ï¼ŒåŠ ç”ŸæŠ½å¤§ç«ç¿»ç‚’3åˆ†é’Ÿ"] },
        { id: 6, name: "å°ç‚’é»„ç‰›è‚‰", main: [{n:"ç‰›è‚‰",q:300,u:"g"}, {n:"å°ç±³è¾£",q:5,u:"ä¸ª"}], season: "é¦™èœ,è’œ,ç”ŸæŠ½,èšæ²¹,æ·€ç²‰", steps: ["ç‰›è‚‰åˆ‡ç‰‡åŠ èšæ²¹æ·€ç²‰è…Œåˆ¶10åˆ†é’Ÿ", "çƒ­æ²¹æ»‘ç‚’ç‰›è‚‰30ç§’å˜è‰²å³æå‡º", "çˆ†é¦™è’œè¾£30ç§’ï¼Œä¸‹ç‰›è‚‰å’Œé¦™èœ", "å¤§ç«çŒ›ç‚’20ç§’å‡ºé”…"] },
        { id: 7, name: "å°ç‚’çŒªè€³æœµ", main: [{n:"ç†ŸçŒªè€³",q:200,u:"g"}, {n:"é’æ¤’",q:2,u:"ä¸ª"}], season: "è’œ,ç”ŸæŠ½", steps: ["çŒªè€³åˆ‡ä¸ï¼Œé’æ¤’åˆ‡ä¸", "çƒ­æ²¹çˆ†è’œ10ç§’ï¼Œä¸‹é’æ¤’ç‚’1åˆ†é’Ÿ", "ä¸‹çŒªè€³å¤§ç«ç¿»ç‚’2åˆ†é’Ÿ", "åŠ ç”ŸæŠ½è°ƒå‘³å‡ºé”…"] },
        { id: 8, name: "ç„–çŒªæ‰‹", main: [{n:"çŒªè¹„",q:2,u:"åª"}], season: "å§œ,å…«è§’,ç”ŸæŠ½,å†°ç³–", steps: ["çŒªè¹„ç„¯æ°´5åˆ†é’Ÿæå‡º", "ç‚’ç³–è‰²åä¸‹çŒªè¹„ç¿»ç‚’3åˆ†é’Ÿ", "åŠ è°ƒæ–™å’Œè¶³é‡æ°´", "å°ç«ç„–ç…®80åˆ†é’Ÿ(æˆ–é«˜å‹é”…20åˆ†é’Ÿ)", "å¤§ç«æ”¶æ±5åˆ†é’Ÿ"] },
        { id: 9, name: "å»éª¨é¸­æŒ", main: [{n:"å»éª¨é¸­æŒ",q:300,u:"g"}, {n:"é…¸èåœ",q:100,u:"g"}], season: "è’œ,ç”ŸæŠ½,èšæ²¹,å¹²è¾£æ¤’", steps: ["é¸­æŒç…®ç†Ÿæå‡ºæ²¥å¹²", "çƒ­æ²¹ç‚’é¦™é…¸èåœå’Œè¾£æ¤’2åˆ†é’Ÿ", "å€’å…¥é¸­æŒå¤§ç«ç‚’3åˆ†é’Ÿ", "åŠ èšæ²¹è°ƒå‘³å‡ºé”…"] },
        { id: 10, name: "ç ‚é”…å«©è±†è…", main: [{n:"å«©è±†è…",q:1,u:"ç›’"}, {n:"è‚‰æœ«",q:50,u:"g"}], season: "è±†ç“£é…±,è’œ,æ°´æ·€ç²‰,è‘±", steps: ["ç‚’é¦™è‚‰æœ«å’Œè±†ç“£é…±1åˆ†é’Ÿ", "åŠ æ°´ç…®å¼€ï¼Œæ”¾å…¥è±†è…ç…®5åˆ†é’Ÿ", "æ·‹å…¥æ°´æ·€ç²‰å‹¾èŠ¡", "æ’’è‘±èŠ±å‡ºé”…"] },
        { id: 11, name: "æ¹˜è¾£è„†ç¬‹", main: [{n:"çƒŸç¬‹/è„†ç¬‹",q:300,u:"g"}, {n:"äº”èŠ±è‚‰ç‰‡",q:50,u:"g"}], season: "å°ç±³è¾£,è’œ,ç”ŸæŠ½,ç›", steps: ["ç¬‹ç‰‡ç„¯æ°´2åˆ†é’Ÿæ²¥å¹²", "ç…¸ç‚’è‚‰ç‰‡å‡ºæ²¹ï¼Œæ”¾è’œè¾£çˆ†é¦™30ç§’", "å€’å…¥ç¬‹ç‰‡å¤§ç«çˆ†ç‚’3åˆ†é’Ÿ", "åŠ ç”ŸæŠ½ç›è°ƒå‘³"] },
        { id: 12, name: "ä¸ç“œæ±¤", main: [{n:"ä¸ç“œ",q:1,u:"æ ¹"}, {n:"é¸¡è›‹",q:2,u:"ä¸ª"}], season: "å§œä¸,ç›,æ²¹", steps: ["ç…è·åŒ…è›‹2åˆ†é’Ÿç››å‡º", "é”…åº•æ²¹ç‚’è½¯ä¸ç“œ1åˆ†é’Ÿ", "åŠ å¼€æ°´ç…®æ²¸3åˆ†é’Ÿæ±¤å˜ç™½", "æ”¾å…¥è›‹å’Œå§œä¸ç…®2åˆ†é’Ÿ"] },
        { id: 13, name: "å°ç‚’é¦™å¹²", main: [{n:"é¦™å¹²",q:6,u:"ç‰‡"}, {n:"èŠ¹èœ",q:50,u:"g"}], season: "çº¢æ¤’,è’œ,ç”ŸæŠ½", steps: ["é¦™å¹²åˆ‡æ¡ï¼ŒèŠ¹èœåˆ‡æ®µ", "çƒ­æ²¹ç…ç‚’é¦™å¹²2åˆ†é’Ÿ", "åŠ èŠ¹èœçº¢æ¤’å¤§ç«ç‚’2åˆ†é’Ÿ", "åŠ ç”ŸæŠ½ç›å‡ºé”…"] },
        { id: 14, name: "ç‚’è±†èŠ½èœ", main: [{n:"ç»¿è±†èŠ½",q:400,u:"g"}], season: "è’œ,å¹²è¾£æ¤’,é¦™é†‹,è‘±", steps: ["çƒ­æ²¹çˆ†é¦™è’œè¾£10ç§’", "å¤§ç«å€’å…¥è±†èŠ½å¿«ç‚’1åˆ†é’Ÿ", "æ·‹é†‹åŠ ç›æ’’è‘±æ®µ", "ç¿»åŒ€ç«‹é©¬å‡ºé”…(é˜²å‡ºæ°´)"] },
        { id: 15, name: "ç…é¸¡è›‹/ç‚’è›‹", main: [{n:"é¸¡è›‹",q:3,u:"ä¸ª"}], season: "æ²¹,ç›", steps: ["é¸¡è›‹æ‰“æ•£åŠ ç›", "çƒ­æ²¹å¤§ç«å€’å…¥è›‹æ¶²", "å¿«é€Ÿåˆ’æ•£ç‚’ç†Ÿçº¦40ç§’", "å–œæ¬¢è€çš„å¯ä»¥ç…1åˆ†é’Ÿ"] },
        { id: 16, name: "å°ç‚’ç™½èœ", main: [{n:"å°ç™½èœ",q:500,u:"g"}], season: "è’œ,å¹²è¾£æ¤’,çŒªæ²¹,é†‹", steps: ["çŒªæ²¹èåŒ–çˆ†é¦™è’œè¾£", "å…ˆç‚’èœå¸®1åˆ†é’Ÿ", "å†æ”¾èœå¶å¤§ç«ç‚’1åˆ†é’Ÿ", "è½¯å¡Œåæ·‹é†‹åŠ ç›"] },
        { id: 17, name: "å°é…¥è‚‰", main: [{n:"äº”èŠ±è‚‰/é‡Œè„Š",q:300,u:"g"}, {n:"çº¢è–¯æ·€ç²‰",q:100,u:"g"}], season: "èŠ±æ¤’,ç›,é¸¡è›‹,æ²¹", steps: ["è‚‰åˆ‡æ¡åŠ èŠ±æ¤’ç›è›‹æ¶²æ·€ç²‰æ‹ŒåŒ€", "æ²¹æ¸©6æˆçƒ­ä¸‹é”…ç‚¸3åˆ†é’Ÿå®šå‹", "å‡é«˜æ²¹æ¸©å¤ç‚¸40ç§’è‡³é‡‘é»„"] },
        { id: 18, name: "ç‚’èŠ±èœ", main: [{n:"æœ‰æœºèŠ±èœ",q:350,u:"g"}, {n:"äº”èŠ±è‚‰ç‰‡",q:50,u:"g"}], season: "å¹²è¾£æ¤’,è’œ,ç”ŸæŠ½", steps: ["èŠ±èœåˆ‡å°æœµç„¯æ°´1åˆ†é’Ÿ", "ç…¸ç‚’è‚‰ç‰‡å‡ºæ²¹åŠ è’œè¾£", "å€’å…¥èŠ±èœå¤§ç«ç¿»ç‚’3åˆ†é’Ÿ", "æ·‹ç”ŸæŠ½ç„¦è¾¹å‡ºé”…"] },
        { id: 19, name: "å¹²é”…åŒ…èœ", main: [{n:"åŒ…èœ",q:0.5,u:"ä¸ª"}, {n:"äº”èŠ±è‚‰ç‰‡",q:50,u:"g"}], season: "å¹²è¾£æ¤’,è’œ,è’¸é±¼è±‰æ²¹", steps: ["åŒ…èœæ‰‹æ’•ï¼Œè‚‰ç‰‡ç…¸ç‚’å‡ºæ²¹", "ä¸‹è’œè¾£çˆ†é¦™", "ä¸‹åŒ…èœå¤§ç«ç‚’è‡³å˜è½¯çº¦3åˆ†é’Ÿ", "æ·‹è±‰æ²¹è°ƒå‘³ï¼Œæœ€å¥½ç”¨é…’ç²¾ç‚‰ä¿æ¸©"] },
        { id: 20, name: "æµ·å¸¦æ±¤", main: [{n:"å¹²æµ·å¸¦/é²œæµ·å¸¦",q:100,u:"g"}, {n:"æ’éª¨/è‚‰ç‰‡",q:100,u:"g"}], season: "å§œ,ç›,è‘±", steps: ["æ’éª¨ç„¯æ°´", "åŠ æ°´å§œç‰‡ç…®30åˆ†é’Ÿ", "åŠ å…¥æµ·å¸¦å†ç…®15åˆ†é’Ÿ", "æ’’è‘±èŠ±åŠ ç›"] },
        { id: 21, name: "è‚‰ä¸¸æ±¤", main: [{n:"çŒªè‚‰é¦…",q:200,u:"g"}, {n:"é’èœ",q:100,u:"g"}], season: "å§œ,æ·€ç²‰,ç™½èƒ¡æ¤’,ç›", steps: ["è‚‰é¦…åŠ æ·€ç²‰ç›æ°´é¡ºæ—¶é’ˆæ…æ‰“ä¸ŠåŠ²", "æ°´å¾®å¼€æ—¶è™å£æŒ¤å…¥è‚‰ä¸¸", "ç…®è‡³æµ®èµ·(çº¦4åˆ†é’Ÿ)", "ä¸‹é’èœç…®1åˆ†é’ŸåŠ ç›èƒ¡æ¤’"] },
        { id: 22, name: "ç²‰ä¸ç…²", main: [{n:"é¾™å£ç²‰ä¸",q:2,u:"æŠŠ"}, {n:"è‚‰æœ«",q:50,u:"g"}], season: "è’œè“‰,è±†ç“£é…±,ç”ŸæŠ½,ç ‚é”…", steps: ["ç²‰ä¸æ³¡è½¯å«åœ¨ç ‚é”…åº•", "ç‚’é¦™è‚‰æœ«è±†ç“£é…±è’œè“‰åŠ æ°´ç…®å¼€", "æ±¤æ±å€’å…¥ç ‚é”…", "ä¸­å°ç«ç…²5åˆ†é’Ÿæ”¶æ±"] },
        { id: 23, name: "ç‚’è±†æ²«/è‚‰æœ«è±†è§’", main: [{n:"å››å­£è±†/é…¸è±†è§’",q:300,u:"g"}, {n:"è‚‰æœ«",q:100,u:"g"}], season: "è’œ,å¹²è¾£æ¤’,ç”ŸæŠ½", steps: ["è±†è§’åˆ‡ç¢æœ«", "ç‚’ç†Ÿè‚‰æœ«ç››å‡º", "åº•æ²¹ç‚’è±†è§’æœ«è‡³è¡¨çš®èµ·çš±(3-4åˆ†é’Ÿ)", "å€’å…¥è‚‰æœ«æ··ç‚’åŠ ç›"] },
        { id: 24, name: "ç‚’ç²‰çš®", main: [{n:"é²œç²‰çš®",q:300,u:"g"}, {n:"é¸¡è›‹",q:2,u:"ä¸ª"}], season: "éŸ­èœ/è èœ,è’œ,ç”ŸæŠ½", steps: ["ç²‰çš®åˆ‡å®½æ¡ï¼Œé¸¡è›‹ç‚’ç†Ÿç››å‡º", "çƒ­æ²¹ç‚’è’œä¸‹ç²‰çš®(å¦‚æœå¤ªå¹²åŠ ç‚¹æ°´)", "ç‚’é€æ˜åä¸‹é…èœå’Œè›‹", "å¤§ç«ç¿»ç‚’1åˆ†é’Ÿ"] },
        { id: 25, name: "è›‹ç‚’é¥­", main: [{n:"éš”å¤œç±³é¥­",q:1,u:"ç¢—"}, {n:"é¸¡è›‹",q:2,u:"ä¸ª"}], season: "è‘±èŠ±,ç›,æ²¹", steps: ["çƒ­é”…å†·æ²¹æ»‘æ•£é¸¡è›‹", "å€’å…¥ç±³é¥­é“²ç¢æŒ‰å‹", "å¤§ç«ä¸åœç¿»ç‚’3åˆ†é’Ÿè‡³ç²’ç²’åˆ†æ˜", "æ’’è‘±èŠ±ç›å‡ºé”…"] },
        { id: 26, name: "è›‹ç‚’ç±³ç²‰", main: [{n:"å¹²ç±³ç²‰",q:150,u:"g"}, {n:"é¸¡è›‹",q:1,u:"ä¸ª"}], season: "é’èœ,ç”ŸæŠ½,è€æŠ½", steps: ["ç±³ç²‰æå‰æ³¡è½¯ç…®ç†Ÿæ²¥å¹²", "ç‚’é¸¡è›‹å’Œé’èœ", "ä¸‹ç±³ç²‰åŠ ç”ŸæŠ½è€æŠ½è°ƒè‰²", "å¤§ç«å¿«ç‚’2åˆ†é’Ÿ(é˜²æ­¢ç²˜é”…)"] },
        { id: 27, name: "é…¸è¾£ç²‰", main: [{n:"çº¢è–¯ç²‰æ¡",q:100,u:"g"}, {n:"èŠ±ç”Ÿç±³",q:20,u:"g"}], season: "é™ˆé†‹,è¾£æ¤’æ²¹,ç”ŸæŠ½,æ¦¨èœ", steps: ["ç²‰æ¡ç…®è½¯æå…¥ç¢—ä¸­", "ç¢—åº•æ”¾é†‹ã€é…±æ²¹ã€è¾£æ¤’æ²¹ã€æ±¤", "åŠ å…¥ç²‰æ¡", "æ’’æ¦¨èœèŠ±ç”Ÿè‘±èŠ±"] },
        { id: 28, name: "èºè›³ç²‰", main: [{n:"è¢‹è£…èºè›³ç²‰",q:1,u:"åŒ…"}], season: "æ°´", steps: ["ç±³ç²‰å†·æ°´ä¸‹é”…ç…®10åˆ†é’Ÿæå‡º", "å¦çƒ§æ°´æ”¾å…¥æ±¤æ–™åŒ…", "åŠ å…¥ç±³ç²‰ç…®2åˆ†é’Ÿ", "æ”¾å…¥èŠ±ç”Ÿè…ç«¹è¾£æ²¹"] },
        { id: 29, name: "æ„é¢", main: [{n:"æ„å¤§åˆ©é¢",q:150,u:"g"}, {n:"è‚‰é…±åŒ…/ç•ªèŒ„è‚‰æœ«",q:1,u:"ä»½"}], season: "ç›,æ²¹,é»‘èƒ¡æ¤’", steps: ["æ°´å¼€åŠ ç›æ²¹ç…®æ„é¢8-10åˆ†é’Ÿ", "æå‡ºæ²¥å¹²", "æ‹Œå…¥åŠ çƒ­çš„è‚‰é…±", "æ’’é»‘èƒ¡æ¤’æ‹ŒåŒ€"] },
        { id: 30, name: "ç‰›æ’", main: [{n:"ç‰›æ’",q:1,u:"å—"}], season: "é»„æ²¹,é»‘èƒ¡æ¤’,æµ·ç›", steps: ["ç‰›æ’è§£å†»å¸å¹²æ°´ä»½", "çƒ­é”…èåŒ–é»„æ²¹", "å¤§ç«æ¯é¢ç…2åˆ†é’Ÿ(è§†åšåº¦)", "é™ç½®é†’è‚‰3åˆ†é’Ÿå†åƒ"] },
        { id: 31, name: "å’–å–±é¥­", main: [{n:"å’–å–±å—",q:2,u:"å—"}, {n:"é¸¡è‚‰/ç‰›è‚‰",q:200,u:"g"}, {n:"åœŸè±†èƒ¡èåœ",q:1,u:"ä»½"}], season: "æ´‹è‘±,æ²¹", steps: ["ç‚’é¦™æ´‹è‘±å’Œè‚‰å—", "åŠ åœŸè±†èƒ¡èåœå—ç¿»ç‚’", "åŠ æ°´æ²¡è¿‡é£Ÿæç‚–10åˆ†é’Ÿ", "å…³ç«åŠ å’–å–±å—èåŒ–", "å¼€å°ç«ç…®æµ“ç¨ "] },
        { id: 32, name: "ç›é…¥é¸¡", main: [{n:"é¸¡èƒ¸è‚‰",q:300,u:"g"}], season: "æ¤’ç›ç²‰,æ·€ç²‰,äº”é¦™ç²‰,ä¹å±‚å¡”(å¯é€‰)", steps: ["é¸¡è‚‰åˆ‡å—åŠ äº”é¦™ç²‰é…±æ²¹è…Œåˆ¶", "è£¹åœ°ç“œç²‰é™ç½®", "æ²¹æ¸©160åº¦ç‚¸3åˆ†é’Ÿ", "å¤ç‚¸30ç§’æ’’æ¤’ç›"] },
        { id: 33, name: "é¦™è¾£é¸¡ç¿…", main: [{n:"é¸¡ç¿…ä¸­",q:6,u:"ä¸ª"}], season: "å¹²è¾£æ¤’,èŠ±æ¤’,å§œè’œ,ç†ŸèŠéº»", steps: ["é¸¡ç¿…å¯¹åŠåˆ‡ï¼Œç‚¸ç†Ÿ(çº¦6åˆ†é’Ÿ)", "é”…ç•™åº•æ²¹çˆ†é¦™å¤§é‡èŠ±æ¤’è¾£æ¤’", "å€’å…¥é¸¡ç¿…ç¿»ç‚’2åˆ†é’Ÿ", "æ’’èŠéº»å‡ºé”…"] },
        { id: 34, name: "è›‹æŒ", main: [{n:"é€Ÿå†»è›‹æŒçš®",q:6,u:"ä¸ª"}, {n:"è›‹æŒæ¶²",q:1,u:"ç›’"}], season: "æ— ", steps: ["çƒ¤ç®±é¢„çƒ­200åº¦", "è›‹æŒæ¶²å€’å…¥çš®ä¸­(8åˆ†æ»¡)", "ä¸­å±‚çƒ¤20-25åˆ†é’Ÿ", "è¡¨é¢å‡ºç°ç„¦ç³–æ–‘ç‚¹å³å¯"] },
        { id: 35, name: "çƒ¤è‚ ", main: [{n:"ç«å±±çŸ³çƒ¤è‚ ",q:4,u:"æ ¹"}], season: "æ²¹", steps: ["é¦™è‚ è§£å†»åˆ’åˆ€èŠ±", "å¹³åº•é”…å°‘æ²¹å°ç«æ…¢ç…", "ä¸åœç¿»åŠ¨çº¦6-8åˆ†é’Ÿ", "è¡¨çš®çˆ†å¼€ç„¦é»„å³å¯"] },
        { id: 36, name: "å®¶å¸¸ç‚’é¢", main: [{n:"é²œé¢æ¡",q:200,u:"g"}, {n:"é’èœ/ç«è…¿",q:1,u:"ä»½"}], season: "è€æŠ½,ç”ŸæŠ½,èšæ²¹,æ²¹", steps: ["æ°´å¼€ä¸‹é¢æ¡ç…®2åˆ†é’Ÿ(å…«åˆ†ç†Ÿ)æå‡ºè¿‡å‡‰æ°´æ²¥å¹²", "é¢æ¡æ·‹å°‘è®¸æ²¹æ‹ŒåŒ€é˜²ç²˜", "çƒ­æ²¹ç‚’é¦™ç«è…¿é’èœ1åˆ†é’Ÿ", "å€’å…¥é¢æ¡ï¼ŒåŠ ç”ŸæŠ½è€æŠ½èšæ²¹ï¼Œå¤§ç«å¿«ç‚’2åˆ†é’Ÿå‡åŒ€ä¸Šè‰²"] },
        { id: 37, name: "æ¸…æ±¤é¢", main: [{n:"æŒ‚é¢",q:100,u:"g"}, {n:"é’èœ",q:2,u:"é¢—"}], season: "çŒªæ²¹,ç”ŸæŠ½,è‘±èŠ±,ç›", steps: ["ç¢—åº•æ”¾çŒªæ²¹ã€ç”ŸæŠ½ã€ç›ã€è‘±èŠ±ï¼ŒåŠ ä¸€å‹ºå¼€æ°´å†²å¼€æ±¤åº•", "æ°´å¼€ä¸‹æŒ‚é¢ç…®4åˆ†é’Ÿ", "æ”¾å…¥é’èœçƒ«1åˆ†é’Ÿ", "æå‡ºé¢å’Œèœæ”¾å…¥æ±¤ç¢—å³å¯"] },
        { id: 38, name: "æ±¤ç²‰", main: [{n:"ç±³ç²‰(å¹²)",q:150,u:"g"}, {n:"è‚‰æœ«",q:50,u:"g"}], season: "è‘±,å§œ,ç›,ç”ŸæŠ½", steps: ["å¹²ç±³ç²‰æå‰å†·æ°´æ³¡è½¯1å°æ—¶(æˆ–ç…®10åˆ†é’Ÿ)", "çƒ­æ²¹ç‚’é¦™è‚‰æœ«å’Œå§œæœ«2åˆ†é’Ÿï¼ŒåŠ æ°´ç…®æ²¸", "æ”¾å…¥æ³¡è½¯çš„ç±³ç²‰ç…®3åˆ†é’Ÿ", "åŠ ç›ç”ŸæŠ½è°ƒå‘³ï¼Œæ’’è‘±èŠ±å‡ºé”…"] },
        { id: 39, name: "æ°´é¥º", main: [{n:"é€Ÿå†»æ°´é¥º",q:1,u:"è¢‹"}], season: "é†‹,è¾£æ¤’æ²¹", steps: ["å®½æ°´ç…®æ²¸ï¼Œä¸‹å…¥é¥ºå­", "ä¿æŒä¸­å¤§ç«ï¼Œæ°´æ²¸åç‚¹ä¸€æ¬¡å‡‰æ°´ï¼Œé‡å¤3æ¬¡(çº¦ç…®8åˆ†é’Ÿ)", "é¥ºå­å…¨éƒ¨æµ®èµ·ä¸”é¼“èƒ€å³å¯æå‡º"] },
        { id: 40, name: "å¤§é¦„é¥¨", main: [{n:"ç”Ÿé¦„é¥¨",q:12,u:"ä¸ª"}, {n:"ç´«èœè™¾çš®",q:1,u:"ä»½"}], season: "é¦™æ²¹,ç”ŸæŠ½,ç›", steps: ["ç¢—ä¸­æ”¾ç´«èœã€è™¾çš®ã€ç›ã€é¦™æ²¹", "æ°´å¼€ä¸‹é¦„é¥¨ï¼Œä¸­å°ç«ç…®5åˆ†é’Ÿ", "ä¸­é€”ç‚¹ä¸€æ¬¡å‡‰æ°´ï¼Œå¾…é¦„é¥¨çš®é€æ˜æµ®èµ·", "å…ˆèˆ€çƒ­æ±¤å†²å¼€ç¢—åº•è°ƒæ–™ï¼Œå†æå…¥é¦„é¥¨"] },
        { id: 41, name: "ç°ç£¨è±†æµ†", main: [{n:"é»„è±†",q:50,u:"g"}, {n:"æ°´",q:800,u:"ml"}], season: "ç³–(å¯é€‰)", steps: ["é»„è±†æå‰å†·æ°´æµ¸æ³¡8å°æ—¶", "å°†æ³¡å¥½çš„è±†å­å’Œæ°´å€’å…¥ç ´å£æœº", "é€‰æ‹©è±†æµ†æ¨¡å¼ï¼Œè¿è¡Œçº¦25åˆ†é’Ÿ", "å€’å‡ºè¿‡æ»¤ï¼ˆå¦‚éœ€ï¼‰ï¼ŒåŠ ç³–æ…æ‹Œå³å¯"] }
    ];

    // === ç³»ç»Ÿåˆå§‹åŒ– ===
    
    // åŠ è½½æ—¶è¯»å–æ’è¡Œæ¦œå’Œä¸Šæ¬¡è®°å½•
    window.onload = function() {
        updateRankingBox();
        showLastRecord();
    };

    // åˆ‡æ¢åº•éƒ¨æŒ‰é’®ç»„
    function switchFooter(pageId) {
        document.querySelectorAll('.footer-group').forEach(el => el.classList.remove('active'));
        if(pageId === 'page-menu') document.getElementById('footer-menu').classList.add('active');
        if(pageId === 'page-shop') document.getElementById('footer-shop').classList.add('active');
        if(pageId === 'page-cook') document.getElementById('footer-cook').classList.add('active');
    }

    function gotoPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        switchFooter(pageId);
        window.scrollTo(0,0);
        
        // æ¯æ¬¡å›åˆ°é¦–é¡µï¼Œåˆ·æ–°æ’è¡Œæ¦œ
        if(pageId === 'page-menu') {
            updateRankingBox();
        }
    }

    // === ä¸šåŠ¡é€»è¾‘ ===

    function selectPeople(type) {
        document.querySelectorAll('.people-btn').forEach(b => b.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        
        let text = "";
        if(type === 1) { multiplier = 1; text = "å½“å‰æ¨¡å¼ï¼š1-2 äººé¤"; }
        if(type === 2) { multiplier = 1.8; text = "å½“å‰æ¨¡å¼ï¼š3-4 äººé¤"; }
        if(type === 3) { multiplier = 3.2; text = "å½“å‰æ¨¡å¼ï¼š4-8 äººé¤"; }
        
        document.getElementById('people-display-text').innerText = text;
        renderMenu();
        gotoPage('page-menu');
    }

    function renderMenu() {
        const grid = document.getElementById('menu-grid');
        grid.innerHTML = '';
        dishes.forEach(dish => {
            const div = document.createElement('div');
            const checkedStr = selectedDishIds.includes(dish.id) ? 'checked' : '';
            div.innerHTML = `
                <input type="checkbox" id="d-${dish.id}" class="dish-check" value="${dish.id}" ${checkedStr}>
                <label for="d-${dish.id}" class="dish-card">${dish.name}</label>
            `;
            grid.appendChild(div);
        });
    }

    function gotoShop() {
        const checks = document.querySelectorAll('.dish-check:checked');
        if (checks.length === 0) { alert('è¯·è‡³å°‘é€‰æ‹©ä¸€é“èœï¼'); return; }
        
        selectedDishIds = Array.from(checks).map(c => parseInt(c.value));
        renderShopList();
        gotoPage('page-shop');
    }

    function renderShopList() {
        const listEl = document.getElementById('shop-main-list');
        const seasonEl = document.getElementById('shop-seasoning-list');
        listEl.innerHTML = '';
        let allSeasons = new Set();

        selectedDishIds.forEach(id => {
            const dish = dishes.find(d => d.id === id);
            dish.main.forEach(m => {
                let finalQ = Math.ceil(m.q * multiplier);
                const li = document.createElement('li');
                li.innerHTML = `<div><span class="dish-label">${dish.name}</span><span>${m.n}</span></div><span class="ing-amount">${finalQ}${m.u}</span>`;
                listEl.appendChild(li);
            });
            if(dish.season && dish.season !== "æ— ") {
                dish.season.split(/[,ï¼Œ]/).forEach(s => allSeasons.add(s.trim()));
            }
        });
        seasonEl.innerText = Array.from(allSeasons).join(' / ') || "æ— éœ€é¢å¤–è°ƒæ–™";
    }

    function copyShoppingList() {
        let copyText = "ğŸ›’ é‡‡è´­æ¸…å•:\n";
        selectedDishIds.forEach(id => {
            const dish = dishes.find(d => d.id === id);
            copyText += `â–ªï¸ ${dish.name}\n`;
            dish.main.forEach(m => {
                let finalQ = Math.ceil(m.q * multiplier);
                copyText += `   ${m.n}: ${finalQ}${m.u}\n`;
            });
            copyText += "\n";
        });
        navigator.clipboard.writeText(copyText).then(() => alert("ğŸ“‹ å·²å¤åˆ¶")).catch(() => alert("å¤åˆ¶å¤±è´¥"));
    }

    // === çƒ¹é¥ª & æ‰“åˆ†é€»è¾‘ ===

    let tempRatings = {}; // ä¸´æ—¶å­˜å‚¨æœ¬æ¬¡æ‰“åˆ†

    function gotoCook() {
        const container = document.getElementById('recipe-container');
        const ratingList = document.getElementById('rating-list');
        container.innerHTML = '';
        ratingList.innerHTML = '';
        tempRatings = {}; // é‡ç½®æœ¬æ¬¡æ‰“åˆ†

        selectedDishIds.forEach(id => {
            const dish = dishes.find(d => d.id === id);
            tempRatings[id] = 5; // é»˜è®¤5æ˜Ÿ

            // 1. æ¸²æŸ“èœè°±
            const card = document.createElement('div');
            card.className = 'recipe-card';
            let stepsHtml = '';
            dish.steps.forEach((step, index) => {
                const highlightedStep = step.replace(/(\d+(?:-\d+)?\s*(?:åˆ†é’Ÿ|ç§’|å°æ—¶|åˆ†))/g, '<span class="time-mark">$1</span>');
                stepsHtml += `<div class="step-row"><div class="step-idx">${index + 1}</div><div>${highlightedStep}</div></div>`;
            });
            card.innerHTML = `<div class="recipe-header">${dish.name}</div><div>${stepsHtml}</div>`;
            container.appendChild(card);

            // 2. æ¸²æŸ“æ‰“åˆ†æ¡
            const rateItem = document.createElement('div');
            rateItem.className = 'rating-item';
            rateItem.innerHTML = `
                <span class="rating-name">${dish.name}</span>
                <div class="stars-container" id="stars-${id}">
                    ${renderStars(id, 5)}
                </div>
            `;
            ratingList.appendChild(rateItem);
        });

        gotoPage('page-cook');
    }

    // æ¸²æŸ“æ˜Ÿæ˜ŸHTML
    function renderStars(dishId, currentScore) {
        let html = '';
        for (let i = 1; i <= 5; i++) {
            const activeClass = i <= currentScore ? 'active' : '';
            html += `<span class="star-btn ${activeClass}" onclick="setRating(${dishId}, ${i})">â˜…</span>`;
        }
        return html;
    }

    // ç‚¹å‡»æ˜Ÿæ˜Ÿ
    window.setRating = function(dishId, score) {
        tempRatings[dishId] = score;
        document.getElementById(`stars-${dishId}`).innerHTML = renderStars(dishId, score);
    }

    // å®Œæˆå¹¶ä¿å­˜
    window.finishAndSave = function() {
        // 1. ä¿å­˜æ‰“åˆ†è®°å½•åˆ° LocalStorage
        let allRatings = JSON.parse(localStorage.getItem(STORAGE_KEY_RATINGS)) || {};
        
        for (let id in tempRatings) {
            if (!allRatings[id]) allRatings[id] = [];
            allRatings[id].push(tempRatings[id]);
        }
        localStorage.setItem(STORAGE_KEY_RATINGS, JSON.stringify(allRatings));

        // 2. ä¿å­˜â€œä¸Šæ¬¡è®°å½•â€
        const lastDishNames = selectedDishIds.map(id => dishes.find(d => d.id === id).name).join(', ');
        // è®¡ç®—æœ¬æ¬¡å¹³å‡åˆ†
        let sum = 0, count = 0;
        for (let id in tempRatings) { sum += tempRatings[id]; count++; }
        const avg = count > 0 ? (sum / count).toFixed(1) : 5.0;
        
        const lastRecord = { names: lastDishNames, score: avg };
        localStorage.setItem(STORAGE_KEY_LAST, JSON.stringify(lastRecord));

        alert("ğŸ‰ è®°å½•å·²ä¿å­˜ï¼ä¸‹æ¬¡ç»§ç»­åŠ æ²¹ï¼");
        location.reload();
    }

    // === æ’è¡Œæ¦œ & ä¸Šæ¬¡è®°å½• ===

    function updateRankingBox() {
        const box = document.getElementById('ranking-box');
        const list = document.getElementById('rank-list-content');
        const allRatings = JSON.parse(localStorage.getItem(STORAGE_KEY_RATINGS));

        if (!allRatings || Object.keys(allRatings).length === 0) {
            box.style.display = 'none';
            return;
        }

        // è®¡ç®—å¹³å‡åˆ†å¹¶æ’åº
        let ranked = [];
        for (let idStr in allRatings) {
            const id = parseInt(idStr);
            const scores = allRatings[id];
            const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
            const dish = dishes.find(d => d.id === id);
            if (dish) {
                ranked.push({ name: dish.name, avg: avg, count: scores.length });
            }
        }

        // æ’åºï¼šå¹³å‡åˆ†é«˜ > æ¬¡æ•°å¤š
        ranked.sort((a, b) => {
            if (b.avg !== a.avg) return b.avg - a.avg;
            return b.count - a.count;
        });

        // å–å‰5
        const top5 = ranked.slice(0, 5);
        if (top5.length > 0) {
            box.style.display = 'block';
            list.innerHTML = top5.map((item, i) => `
                <li class="rank-item">
                    <span><span class="rank-badge">${i + 1}</span>${item.name}</span>
                    <span class="rank-score">â˜… ${item.avg.toFixed(1)}</span>
                </li>
            `).join('');
        }
    }

    function showLastRecord() {
        const record = JSON.parse(localStorage.getItem(STORAGE_KEY_LAST));
        const bar = document.getElementById('last-record-bar');
        
        if (record) {
            bar.style.display = 'block';
            bar.innerHTML = `ğŸ•’ ä¸Šæ¬¡åšèœ: ${record.names} <span style="color:#ffc107; margin-left:5px;">â˜… ${record.score}</span>`;
        }
    }

</script>

</body>
</html>